package target

import (
	"fmt"
	probing "github.com/prometheus-community/pro-bing"
	"net"
)

type ClientTarget struct {
	Addr           net.IP
	WebPort        uint16
	ProxyAddr      net.IP
	ProxySocksPort uint16
	ProxyHttpPort  uint16
}

func (t ClientTarget) GetWebAddr() string {
	return fmt.Sprintf("http://%v:%d", t.Addr.String(), t.WebPort)
}

func (t ClientTarget) GetSocksProxyAddr() string {
	if t.ProxyAddr != nil {
		return fmt.Sprintf("%v:%d", t.ProxyAddr.String(), t.ProxySocksPort)
	} else {
		return ""
	}
}

func (t ClientTarget) GetHttpProxyAddr() string {
	if t.ProxyAddr != nil {
		return fmt.Sprintf("http://%v:%d", t.ProxyAddr.String(), t.ProxyHttpPort)
	} else {
		return ""
	}
}

// DiscoveryHost 尝试ping目标，能ping通就认为可以ssh连接
func DiscoveryHost(t ClientTarget) error {
	pinger, err := probing.NewPinger(t.Addr.String())
	if err != nil {
		return err
	}
	pinger.Count = 1
	err = pinger.Run()
	return err
}
