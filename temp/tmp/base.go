package tmp

import (
	"strings"
)

func baseCheck() {
	printMsg("## 基础配置检查")
	printMsg("### 系统信息")

	// 当前用户
	printMsg("**USER:**\t\t" + getCommandOutput("whoami"))

	// OS版本
	printMsg("**OS Version:**\t" + getCommandOutput("uname", "-r"))

	// 主机名
	printMsg("**Hostname:**\t" + getCommandOutput("hostname", "-s"))

	// 服务器SN
	printMsg("**服务器SN:**\t" + getCommandOutput("bash", "-c", "dmidecode -t1 | grep -oP '(?<=Serial Number: ).*'"))

	// Uptime
	printMsg("**Uptime:**\t" + getCommandOutput("bash", "-c", "uptime | awk -F ',' '{print $1}'"))

	// 系统负载
	printMsg("**系统负载:**\t" + getCommandOutput("bash", "-c", "uptime | awk '{print $9\" \"$10\" \"$11\" \"$12\" \"$13}'"))

	// CPU信息
	printMsg("**CPU info:**\t" + getCommandOutput("bash", "-c", "grep -oP '(?<=model name\t: ).*' </proc/cpuinfo | head -n 1"))

	// CPU核心数
	printMsg("**CPU 核心:**\t" + getCommandOutput("bash", "-c", "cat /proc/cpuinfo | grep 'processor' | sort | uniq | wc -l"))

	// IP地址
	ipaddress := getCommandOutput("bash", "-c", "ifconfig | grep -oP '(?<=inet |inet addr:)\\d+\\.\\d+\\.\\d+\\.\\d+' | grep -v '127.0.0.1'")
	printMsg("**IPADDR:**\t" + strings.ReplaceAll(ipaddress, "\n", " "))

	// 内存占用
	printMsg("### 内存占用")
	printCode(getCommandOutput("free", "-mh"))

	// 剩余空间
	printMsg("### 剩余空间")
	printCode(getCommandOutput("df", "-mh"))

	// 硬盘挂载
	printMsg("### 硬盘挂载")
	printCode(getCommandOutput("bash", "-c", "grep -v '#' </etc/fstab | awk '{print $1,$2,$3}'"))

	// 安装软件
	printMsg("### /etc/hosts")
	for _, cmdline := range []string{
		"which perl", "which gcc", "which g++", "which python", "which php",
		"which cc", "which go", "which node", "which nodejs", "which bind",
		"which tomcat", "which clang", "which ruby", "which curl", "which wget",
		"which mysql", "which redis", "which ssserver", "which vsftpd", "which java",
		"which apache", "which apache2", "which nginx", "which git", "which mongodb",
		"which docker", "which tftp", "which psql", "which kafka",
	} {
		printMsg(cmdline + ":\t" + getCommandOutput("bash", "-c", cmdline))
	}
}
